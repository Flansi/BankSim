<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wien ONline-Bank</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <header class="bg-primary text-white text-center py-3 mb-4">
        <h1 class="h3 m-0">Wien ONline-Bank</h1>
    </header>
    <nav class="nav justify-content-center mb-4">
        <a class="nav-link" href="filialen.html">Filialen</a>
        <a class="nav-link" href="mitarbeiter.html">Mitarbeiter</a>
        <a class="nav-link" href="kundenservice.html">Kundenservice</a>
        <a class="nav-link" href="sperrhotline.html">Sperrhotline</a>
        <a class="nav-link" href="rechner.html">Rechner</a>
        <a class="nav-link" href="karriere.html">Karriere</a>
    </nav>
    {% if not session.get('user_id') %}
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="card p-4 mb-4">
                    <h2 class="h4 mb-3 text-center">Login</h2>
                    {% if error %}<p class="text-danger">{{ error }}</p>{% endif %}
                    <form method="post" action="{{ url_for('login', from_index=1) }}">
                        <div class="mb-3">
                            <input type="text" name="username" class="form-control" placeholder="Benutzername" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" name="password" class="form-control" placeholder="Passwort" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Einloggen</button>
                    </form>
                    <div class="text-center mt-2">
                        <a href="{{ url_for('register') }}">Registrieren</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card p-4">
                    <h2 class="h5 mb-3">Aktuelles bei Wien ONline-Bank</h2>
                    <ul class="list-unstyled mb-0">
                        <li><strong>Neue App-Version:</strong> Unsere mobile Banking-App wurde aktualisiert und bietet Ihnen jetzt noch mehr Komfort.</li>
                        <li><strong>Filialeröffnung:</strong> Besuchen Sie ab Mai unsere neue Filiale am Stephansplatz.</li>
                        <li><strong>Sicher online:</strong> Lesen Sie unsere neuesten Tipps zum Schutz vor Phishing.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div id="app" class="container d-flex">
        <nav class="nav flex-column me-4 mb-4">
            <a class="nav-link" href="#" onclick="showPage('home')">Home</a>
            <a class="nav-link" href="#" onclick="showPage('balance')">Kontostand</a>
            <a class="nav-link" href="#" onclick="showPage('transfer')">Überweisung</a>
            <a class="nav-link" href="#" onclick="showPage('settings')">Einstellungen</a>
            <a class="nav-link" href="{{ url_for('logout') }}">Abmelden</a>
        </nav>
        <div id="content" class="flex-grow-1"></div>
    </div>
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showPage(page) {
            const content = document.getElementById('content');
            switch(page) {
                case 'home':
                    content.innerHTML = `
                        <h2>Willkommen bei Wien ONline-Bank!</h2>
                        <p>Schön, dass Sie sich eingeloggt haben. In den letzten Monaten haben wir intensiv daran gearbeitet, unseren Service für Sie noch komfortabler zu gestalten. Unsere Entwicklerinnen und Entwickler haben unzählige Stunden investiert, um Prozesse zu optimieren und neue Funktionen zu schaffen, die Ihren Alltag erleichtern sollen.</p>
                        <p>So haben wir etwa unsere Online-Filiale erweitert und bieten Ihnen nun eine Reihe zusätzlicher Services an. Gleichzeitig wurden auch mehrere unserer Standorte modernisiert, damit Sie vor Ort ein ebenso zeitgemäßes Beratungserlebnis genießen können. Hinter den Kulissen investieren wir stetig in die Sicherheit unserer Systeme, damit Sie sich auch online jederzeit gut aufgehoben fühlen.</p>
                        <h3>Neuigkeiten</h3>
                        <ul>
                            <li><strong>Neue Kreditangebote:</strong> Ab sofort können Sie besonders günstige Wohnbaufinanzierungen beantragen, die wir gemeinsam mit unseren Partnern entwickelt haben.</li>
                            <li><strong>Modernisierte Überweisungen:</strong> Dank einer überarbeiteten Infrastruktur laufen SEPA-Überweisungen jetzt noch schneller und zuverlässiger ab.</li>
                            <li><strong>Veranstaltungen:</strong> In Kürze finden wieder Informationsabende rund um Finanzplanung und Vorsorge in unseren Filialen statt.</li>
                            <li><strong>Digitale Services:</strong> Unsere beliebte Mobile-App erhält demnächst ein größeres Update mit zusätzlichen Analysefunktionen.</li>
                        </ul>
                        <p class="mt-4"><small>Achtung: Betrüger geben sich gelegentlich als Microsoft-Mitarbeiter aus, um an persönliche Daten zu gelangen. Bitte bleiben Sie wachsam.</small></p>
                    `;
                    break;
                case 'balance':
                    content.innerHTML = `
                        <h2>Kontostand</h2>
                        <p>Aktueller Kontostand: <strong>{{ "%.2f" % balance }} €</strong></p>
                        <h3>Buchungshistorie</h3>
                        <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Datum</th>
                                    <th>Buchungstext</th>
                                    <th>Betrag</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for t in transactions %}
                                <tr><td>{{ t.date.strftime('%d.%m.%Y') }}</td><td>{{ t.description }}</td><td>{{ '%+.2f' % t.amount }} €</td></tr>
                            {% endfor %}

                            </tbody>
                        </table>
                        </div>
                    `;
                    break;
                case 'transfer':
                    content.innerHTML = `
                        <h2>Überweisung</h2>
                        <form class="row g-3" onsubmit="submitTransfer(event)">
                            <div class="col-12">
                                <label for="recipient" class="form-label">Empfänger</label>
                                <input id="recipient" name="recipient" class="form-control" type="text" placeholder="Name des Empfängers" required>
                            </div>
                            <div class="col-md-6">
                                <label for="iban" class="form-label">IBAN</label>
                                <input id="iban" name="iban" class="form-control" type="text" placeholder="DE00 0000 0000 0000 0000 00" required>
                            </div>
                            <div class="col-md-6">
                                <label for="bic" class="form-label">BIC</label>
                                <input id="bic" name="bic" class="form-control" type="text" placeholder="BANKDEFFXXX" required>
                            </div>
                            <div class="col-md-6">
                                <label for="amount" class="form-label">Betrag in EUR</label>
                                <input id="amount" name="amount" class="form-control" type="number" step="0.01" placeholder="0,00" required>
                            </div>
                            <div class="col-md-6">
                                <label for="purpose" class="form-label">Verwendungszweck</label>
                                <input id="purpose" name="purpose" class="form-control" type="text" placeholder="Verwendungszweck">
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary w-100">Überweisen</button>
                            </div>
                        </form>
                    `;
                    break;
                case 'settings':
                    content.innerHTML = '<h2>Einstellungen</h2><p>Hier können Sie Ihre persönlichen Einstellungen vornehmen.</p>';
                    break;
                default:
                    content.innerHTML = '';
            }
        }

        function submitTransfer(event) {
            event.preventDefault();
            const form = event.target;
            const data = new FormData(form);
            fetch('/transfer', {method: 'POST', body: data}).then(res => {
                if (res.ok) {
                    alert('Überweisung ausgeführt');
                    window.location.href = '/?page=balance';
                } else {
                    alert('Fehler bei der Überweisung');
                }
            });
        }
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const page = params.get('page') || 'home';
            showPage(page);
        });
    </script>
</body>
</html>
